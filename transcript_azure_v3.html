<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Claire Lu 盧華超">

    <title>Speech Transcription Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            min-height: 100vh;
            padding: 20px;
             /* Gradient background */
            background: linear-gradient(135deg, #f3f5f7 0%, #5d7ddd 100%);
        }
        
        /* Overlay to improve text readability */
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
           /* background: rgba(255, 255, 255, 0.85); */
            z-index: -1;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            position: relative;
            z-index: 1;
        }
        
        header {
            background: linear-gradient(135deg, #e8c3ab 0%, #633608 100%);
            color: white;
            padding: 25px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0,0 L100,0 L100,100 Z" fill="rgba(255,255,255,0.1)"/></svg>');
            background-size: cover;
        }
        
        h1 {
            font-size: 28px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            position: relative;
        }
        
        .tagline {
            font-size: 16px;
            opacity: 0.9;
            position: relative;
        }
        
        .content {
            padding: 30px;
        }
        
        .api-config {
            background: #f8f5f2;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid #e0d6cc;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #5D4037;
        }
        
        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #d2d0ce;
            border-radius: 4px;
            font-size: 16px;
            transition: border-color 0.2s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #8B4513;
            box-shadow: 0 0 0 2px rgba(139, 69, 19, 0.2);
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: auto;
        }
        
        .custom-model-config {
            background: #f0f7ff;
            border: 1px solid #cce5ff;
            border-radius: 6px;
            padding: 15px;
            margin-top: 10px;
            display: none;
        }
        
        .custom-model-config.active {
            display: block;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            background: #a97531;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn:hover {
            background: #2d68a0f7;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn:disabled {
            background: #a19f9d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-success {
            background: #388E3C;
        }
        
        .btn-success:hover {
            background: #2E7D32;
        }
        
        .btn-danger {
            background: #D32F2F;
        }
        
        .btn-danger:hover {
            background: #C62828;
        }
        
        .btn-secondary {
            background: #a97531;
        }
        
        .btn-secondary:hover {
            background: #4E342E;
        }
        
        .controls {
            display: flex;
            gap: 12px;
            margin: 25px 0;
            flex-wrap: wrap;
        }
        
        .status {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-weight: 600;
            background: #f3f2f1;
        }
        
        .status-listening {
            background: #dff6dd;
            color: #107c10;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.8; }
            100% { opacity: 1; }
        }
        
        .transcript-container {
            border: 1px solid #d2d0ce;
            border-radius: 8px;
            overflow: hidden;
            margin: 25px 0;
        }
        
        .transcript-header {
            background: #faf9f8;
            padding: 15px 20px;
            border-bottom: 1px solid #d2d0ce;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        #transcript {
            height: 300px;
            overflow-y: auto;
            padding: 20px;
            background: white;
            line-height: 1.8;
        }
        
        .transcript-footer {
            background: #faf9f8;
            padding: 15px 20px;
            border-top: 1px solid #d2d0ce;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .transcript-actions {
            display: flex;
            gap: 10px;
        }
        
        .interim {
            color: #605e5c;
            font-style: italic;
        }
        
        .final {
            color: #323130;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #f3f2f1;
        }
        
        .language-selector {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .language-option {
            flex: 1;
            min-width: 200px;
        }
        
        .instructions {
            background: #fff4ce;
            border-left: 4px solid #ffaa44;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 4px;
        }
        
        .instructions h3 {
            margin-bottom: 10px;
            color: #8a5000;
        }
        
        .instructions ol {
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 8px;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #605e5c;
            font-size: 14px;
            border-top: 1px solid #d2d0ce;
        }
        
        .temple-icon {
            font-size: 24px;
        }
        
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .language-option {
                min-width: 100%;
            }
            
            .transcript-footer {
                flex-direction: column;
                align-items: stretch;
            }
            
            .transcript-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .transcript-actions .btn {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>
                <span class="temple-icon"></span>
                Live Speech Transcription Tool (For FGS Only)<br>即時語音轉文字工具（香港佛光道場專用）
            </h1>
            <p class="tagline">Version Enhanced by AI<br>AI增強測試版</p>
        </header>
        
        <div class="content">
            <stong>Note:</stong> This enhanced version uses Microsoft Azure Cloud Speech-to-Text API for better accuracy. Please contact the author to obtain the Microsoft Cloud API key to use this service..
注意：此增強版本使用微軟Azure雲語音轉文字API以獲得更高的準確性。請先聯繫作者獲得微軟雲API密鑰來使用此服務。
            <div class="api-config">
                <h3>API Configuration 配置</h3>
                <div class="form-group">
                    <label for="subscriptionKey">Azure Subscription Key</label>
                    <input type="password" id="subscriptionKey" placeholder="Enter your Azure Speech Service key">
                </div>
                <div class="form-group">
                    <label for="serviceRegion">Azure Service Region</label>
                    <input type="text" id="serviceRegion" placeholder="e.g., eastus, westeurope" value="eastus">
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="useCustomModel">
                    <label for="useCustomModel">Use Custom Speech Model 使用自定義語音模型</label>
                </div>
                
                <div class="custom-model-config" id="customModelConfig">
                    <div class="form-group">
                        <label for="customEndpointId">Custom Model Endpoint ID</label>
                        <input type="text" id="customEndpointId" placeholder="Enter your custom endpoint ID">
                    </div>
                </div>
                
                <button id="saveConfig" class="btn">Save Configuration 保存配置</button>
            </div>
            
            <div class="language-selector">
                <div class="language-option">
                    <label for="language">Select Language</label>
                    <select id="language">
                        <option value="zh-TW">Chinese (Traditional, Taiwan) 繁體中文</option>
                        <option value="zh-CN">Chinese (Simplified, Mandarin) 簡體中文</option>
                        <option value="en-US">English (United States)</option>
                       <!--   <option value="fr-FR">French (France)</option>  --> 

                    </select>
                </div>
            </div>
            
            <div class="status" id="status">
                Ready to start transcription 準備開始轉錄
            </div>
            
            <div class="controls">
                <button id="startBtn" class="btn btn-success" disabled>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 5.5V7H9V5.5L3 7V9L9 10.5V12L5 13V15L9 13.5V15H15V13.5L21 15V13L15 11.5V10.5L21 9Z"/>
                    </svg>
                    Start Listening 開始聆聽
                </button>
                <button id="stopBtn" class="btn btn-danger" disabled>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <rect x="6" y="6" width="12" height="12"/>
                    </svg>
                    Stop Listening 停止聆聽
                </button>
            </div>
            
            <div class="transcript-container">
                <div class="transcript-header">
                    <span>Live Transcript</span>
                    <span id="wordCount">0 words</span>
                </div>
                <div id="transcript"></div>
                <div class="transcript-footer">
                    <div class="transcript-actions">
                        <button id="clearBtn" class="btn btn-secondary">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
                            </svg>
                            Clear Transcript 清除內容
                        </button>
                        <button id="downloadBtn" class="btn btn-secondary">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z"/>
                            </svg>
                            Download Transcript 下載文字稿
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="instructions">
                <h3>How to use this transcription tool: <br>如何使用此轉錄工具：</h3>
                <ol>
                    <li>Enter your Azure Speech Service subscription key and region<br>輸入微軟語音服務密鑰和地區</li>
                    <li>Select the language you'll be speaking in<br>選擇輸出語言</li>
                    <li>Click "Start Listening" and allow microphone access when prompted<br>點擊「開始聆聽」，並在提示時允許麥克風訪問</li>
                    <li>Begin speaking - your words will appear in real-time<br>開始說話——你的話語將即時顯示</li>
                    <li>Click "Stop Listening" when finished<br>完成後點擊「停止聆聽」</li>
                    <li>Use "Download Transcript" to save your text<br>使用「下載文字稿」來保存你的文本</li>
                   

                </ol>
            </div>
        </div>
        
        <footer>
            <p>live Speech Transcription for FGS only &copy; 2023 | Powered by Azure Cognitive Services</p>
        </footer>
    </div>

    <!-- Microsoft Cognitive Services Speech SDK -->
    <script src="https://aka.ms/csspeech/jsbrowserpackageraw"></script>
    
    <script>
        class MicrosoftSpeechTranscriber {
            constructor() {
                this.recognizer = null;
                this.isListening = false;
                
                // DOM elements
                this.transcriptElement = document.getElementById('transcript');
                this.statusElement = document.getElementById('status');
                this.wordCountElement = document.getElementById('wordCount');
                this.startBtn = document.getElementById('startBtn');
                this.stopBtn = document.getElementById('stopBtn');
                this.clearBtn = document.getElementById('clearBtn');
                this.downloadBtn = document.getElementById('downloadBtn');
                this.subscriptionKeyInput = document.getElementById('subscriptionKey');
                this.serviceRegionInput = document.getElementById('serviceRegion');
                this.saveConfigBtn = document.getElementById('saveConfig');
                this.languageSelect = document.getElementById('language');
                this.useCustomModelCheckbox = document.getElementById('useCustomModel');
                this.customEndpointIdInput = document.getElementById('customEndpointId');
                this.customModelConfig = document.getElementById('customModelConfig');
                
                // Configuration
                this.subscriptionKey = localStorage.getItem('azureSpeechKey') || '';
                this.serviceRegion = localStorage.getItem('azureSpeechRegion') || 'eastus';
                this.useCustomModel = localStorage.getItem('useCustomModel') === 'true';
                this.customEndpointId = localStorage.getItem('customEndpointId') || '';
                
                this.subscriptionKeyInput.value = this.subscriptionKey;
                this.serviceRegionInput.value = this.serviceRegion;
                this.useCustomModelCheckbox.checked = this.useCustomModel;
                this.customEndpointIdInput.value = this.customEndpointId;
                
                // Transcript storage
                this.fullTranscript = '';
                
                this.setupEventListeners();
                this.updateUI();
                this.toggleCustomModelConfig();
            }
            
            setupEventListeners() {
                this.startBtn.addEventListener('click', () => this.startTranscription());
                this.stopBtn.addEventListener('click', () => this.stopTranscription());
                this.clearBtn.addEventListener('click', () => this.clearTranscript());
                this.downloadBtn.addEventListener('click', () => this.downloadTranscript());
                this.saveConfigBtn.addEventListener('click', () => this.saveConfiguration());
                this.useCustomModelCheckbox.addEventListener('change', () => this.toggleCustomModelConfig());
                
                // Enable start button if we have configuration
                if (this.subscriptionKey && this.serviceRegion) {
                    this.startBtn.disabled = false;
                }
            }
            
            toggleCustomModelConfig() {
                if (this.useCustomModelCheckbox.checked) {
                    this.customModelConfig.classList.add('active');
                } else {
                    this.customModelConfig.classList.remove('active');
                }
            }
            
            saveConfiguration() {
                this.subscriptionKey = this.subscriptionKeyInput.value.trim();
                this.serviceRegion = this.serviceRegionInput.value.trim();
                this.useCustomModel = this.useCustomModelCheckbox.checked;
                this.customEndpointId = this.customEndpointIdInput.value.trim();
                
                if (!this.subscriptionKey) {
                    this.updateStatus('Please enter a valid subscription key', 'error');
                    return;
                }
                
                if (!this.serviceRegion) {
                    this.updateStatus('Please enter a service region', 'error');
                    return;
                }
                
                if (this.useCustomModel && !this.customEndpointId) {
                    this.updateStatus('Please enter a custom endpoint ID when using custom model', 'error');
                    return;
                }
                
                // Save to localStorage
                localStorage.setItem('azureSpeechKey', this.subscriptionKey);
                localStorage.setItem('azureSpeechRegion', this.serviceRegion);
                localStorage.setItem('useCustomModel', this.useCustomModel);
                localStorage.setItem('customEndpointId', this.customEndpointId);
                
                this.updateStatus('Configuration saved successfully', 'success');
                this.startBtn.disabled = false;
            }
            
            async startTranscription() {
                if (!this.subscriptionKey || !this.serviceRegion) {
                    this.updateStatus('Please configure your Azure Speech Service first', 'error');
                    return;
                }
                
                if (this.useCustomModel && !this.customEndpointId) {
                    this.updateStatus('Please configure custom endpoint ID for custom model', 'error');
                    return;
                }
                
                try {
                    const speechConfig = SpeechSDK.SpeechConfig.fromSubscription(
                        this.subscriptionKey, 
                        this.serviceRegion
                    );
                    
                    // Set language
                    speechConfig.speechRecognitionLanguage = this.languageSelect.value;
                    
                    // Apply custom model if enabled
                    if (this.useCustomModel) {
                        speechConfig.endpointId = this.customEndpointId;
                        console.log('Using custom speech model with endpoint:', this.customEndpointId);
                    }
                    
                    // Create audio config
                    const audioConfig = SpeechSDK.AudioConfig.fromDefaultMicrophoneInput();
                    
                    // Create recognizer
                    this.recognizer = new SpeechSDK.SpeechRecognizer(speechConfig, audioConfig);
                    
                    // Setup event handlers
                    this.recognizer.recognizing = (s, e) => {
                        this.updateTranscript(e.result.text, false);
                    };
                    
                    this.recognizer.recognized = (s, e) => {
                        if (e.result.reason === SpeechSDK.ResultReason.RecognizedSpeech) {
                            this.updateTranscript(e.result.text, true);
                        }
                    };
                    
                    this.recognizer.canceled = (s, e) => {
                        console.log(`CANCELED: Reason=${e.reason}`);
                        
                        if (e.reason === SpeechSDK.CancellationReason.Error) {
                            console.log(`CANCELED: ErrorCode=${e.errorCode}, ErrorDetails=${e.errorDetails}`);
                            this.updateStatus(`Recognition error: ${e.errorDetails}`, 'error');
                        }
                        
                        this.stopTranscription();
                    };
                    
                    // Start recognition
                    this.recognizer.startContinuousRecognitionAsync(
                        () => {
                            this.isListening = true;
                            this.updateUI();
                            const modelType = this.useCustomModel ? 'Custom Model' : 'Standard Model';
                            this.updateStatus(`Listening... Speak now! (${modelType})`, 'listening');
                        },
                        (err) => {
                            console.error('Error starting recognition:', err);
                            this.updateStatus('Error starting speech recognition', 'error');
                        }
                    );
                    
                } catch (error) {
                    console.error('Error initializing speech recognition:', error);
                    this.updateStatus('Error initializing speech recognition. Check your configuration.', 'error');
                }
            }
            
            stopTranscription() {
                if (this.recognizer) {
                    this.recognizer.stopContinuousRecognitionAsync(
                        () => {
                            this.isListening = false;
                            this.updateUI();
                            this.updateStatus('Transcription stopped', 'stopped');
                            this.recognizer.close();
                            this.recognizer = null;
                        },
                        (err) => {
                            console.error('Error stopping recognition:', err);
                            this.updateStatus('Error stopping recognition', 'error');
                        }
                    );
                } else {
                    this.isListening = false;
                    this.updateUI();
                    this.updateStatus('Transcription stopped', 'stopped');
                }
            }
            
            updateTranscript(text, isFinal) {
                if (!text) return;
                
                // Remove any existing interim result
                const existingInterim = this.transcriptElement.querySelector('.interim');
                if (existingInterim) {
                    existingInterim.remove();
                }
                
                // Add to full transcript if final
                if (isFinal) {
                    this.fullTranscript += text + ' ';
                    
                    const finalElement = document.createElement('div');
                    finalElement.textContent = text;
                    finalElement.className = 'final';
                    this.transcriptElement.appendChild(finalElement);
                } else {
                    // Add interim result
                    const interimElement = document.createElement('div');
                    interimElement.textContent = text;
                    interimElement.className = 'interim';
                    this.transcriptElement.appendChild(interimElement);
                }
                
                // Auto-scroll to bottom
                this.transcriptElement.scrollTop = this.transcriptElement.scrollHeight;
                
                // Update word count
                this.updateWordCount();
            }
            
            updateWordCount() {
                const wordCount = this.fullTranscript.trim() ? this.fullTranscript.trim().split(/\s+/).length : 0;
                this.wordCountElement.textContent = `${wordCount} words`;
            }
            
            clearTranscript() {
                this.transcriptElement.innerHTML = '';
                this.fullTranscript = '';
                this.updateWordCount();
                this.updateStatus('Transcript cleared', 'success');
            }
            
            downloadTranscript() {
                if (!this.fullTranscript.trim()) {
                    this.updateStatus('No transcript to download', 'error');
                    return;
                }
                
                const blob = new Blob([this.fullTranscript], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `transcript-${new Date().toISOString().split('T')[0]}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.updateStatus('Transcript downloaded', 'success');
            }
            
            updateStatus(message, type) {
                this.statusElement.textContent = message;
                
                // Remove all status classes
                this.statusElement.classList.remove('status-listening');
                
                // Add appropriate class based on type
                if (type === 'listening') {
                    this.statusElement.classList.add('status-listening');
                } else if (type === 'error') {
                    this.statusElement.style.background = '#fde7e9';
                    this.statusElement.style.color = '#a4262c';
                } else if (type === 'success') {
                    this.statusElement.style.background = '#dff6dd';
                    this.statusElement.style.color = '#107c10';
                } else {
                    this.statusElement.style.background = '#f3f2f1';
                    this.statusElement.style.color = '#323130';
                }
            }
            
            updateUI() {
                this.startBtn.disabled = this.isListening || !this.subscriptionKey || !this.serviceRegion;
                this.stopBtn.disabled = !this.isListening;
            }
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new MicrosoftSpeechTranscriber();
        });
    </script>
</body>
</html>